<div class="dashboard-container" data-controller="native-board">

    {# 
       NOUVELLE BOUCLE : 
       On boucle sur l'entité 'poles' passée par le contrôleur PHP 
    #}
    {% for pole in poles %}
        
        <div class="pole-section">
            <h3 class="pole-title">{{ pole.nomPole }}</h3>
            
            {# 
               IMPORTANT :
               Le style "min-height" est CRUCIAL ici.
               Si le pôle est vide, sans min-height, la div fera 0px de haut 
               et tu ne pourras rien déposer dedans.
            #}
            <div class="dashboard-grid" 
                 data-pole="{{ pole.nomPole }}"
                 data-action="dragover->native-board#onDragOver drop->native-board#onDrop dragenter->native-board#onDragEnter dragleave->native-board#onDragLeave"
                 style="min-height: 150px; transition: background 0.2s;">
                
                {# BOUCLE DES MILITANTS #}
                {% for militant in militants %}
                    
                    {# 
                       CONDITION DE TRI :
                       On vérifie si le militant appartient au pôle actuel de la boucle
                       (On compare les ID pour être sûr, ou les noms)
                    #}
                    {% if militant.pole and militant.pole.id == pole.id %}
                        
                        <div class="mini-card" 
                             draggable="true" 
                             data-id="{{ militant.id }}"
                             data-action="dragstart->native-board#onDragStart dragend->native-board#onDragEnd"
                             style="cursor: grab;">

                            <div class="status-dot" title="Présent"></div>

                            <div class="card-name">
                                {{ militant.prenom }} {{ militant.nom|upper }}
                            </div>
                                
                            <div class="card-pole">
                                <i class="fas fa-map-marker-alt"></i> 
                                <span class="pole-text">{{ militant.pole.nomPole }}</span>
                            </div>

                            <div class="card-time">
                                <i class="far fa-clock"></i>
                                {# ... Tes horaires ... #}
                                {% for horaire in militant.horaires %}
                                    {% if horaire.debut <= date() and horaire.fin >= date() %}
                                        {{ horaire.debut|date('H:i') }} - {{ horaire.fin|date('H:i') }}
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <div class="card-actions">
                                {# ... Tes boutons ... #}
                                <a href="#" class="btn-mini btn-info-card"><i class="fas fa-eye"></i> Info</a>
                            </div>
                        </div>

                    {% endif %}
                {% endfor %}
                
                {# 
                   Astuce UX : Tu peux ajouter un message si vide
                   (Visible uniquement si aucun enfant .mini-card n'est présent, via CSS :empty)
                #}
                {# <div class="empty-state">Aucun militant</div> #}
                
            </div>
        </div>

    {% endfor %}
</div>