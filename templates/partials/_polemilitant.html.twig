{# 1. On crée la liste des noms de pôles uniques #}
{% set poleNames = [] %}
{% for m in militants %}
    {% if m.pole and m.pole.nomPole not in poleNames %}
        {% set poleNames = poleNames|merge([m.pole.nomPole]) %}
    {% endif %}
{% endfor %}

<div class="dashboard-container">
    {# Tu peux remettre un titre général ici si tu veux #}
    
    {# 2. BOUCLE DES PÔLES (Colonnes) #}
    {% for currentPoleName in poleNames %}
        
        <div class="pole-section">
            <h3 class="pole-title">{{ currentPoleName }}</h3>
            
            <div class="dashboard-grid">
                {# 3. BOUCLE DES MILITANTS (Cartes) #}
                {% for militant in militants %}
                    {% if militant.pole and militant.pole.nomPole == currentPoleName %}
                        
                        <div class="mini-card">
                            <div class="status-dot" title="Présent"></div>

                            <div class="card-name" title="{{ militant.prenom }} {{ militant.nom }}">
                                {{ militant.prenom }} {{ militant.nom|upper }}
                            </div>

                            <div class="card-pole">
                                <i class="fas fa-map-marker-alt"></i> {{ militant.pole.nomPole }}
                            </div>

                            <div class="card-time">
                                <i class="far fa-clock"></i>
                                {% for horaire in militant.horaires %}
                                    {% if horaire.debut <= date() and horaire.fin >= date() %}
                                        {{ horaire.debut|date('H:i') }} - {{ horaire.fin|date('H:i') }}
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <div class="card-actions">
                                {% if militant.tel %}
                                    <a href="tel:{{ militant.tel }}" class="btn-mini btn-call">
                                        <i class="fas fa-phone"></i> Appeler
                                    </a>
                                {% else %}
                                    <span class="btn-mini btn-call disabled">
                                        <i class="fas fa-phone-slash"></i>
                                    </span>
                                {% endif %}
                                <a href="#" class="btn-mini btn-info-card">
                                    <i class="fas fa-eye"></i> Info
                                </a>
                            </div>
                        </div>

                    {% endif %}
                {% endfor %}
            </div>
        </div>

    {% endfor %}
</div>