{% extends 'base.html.twig' %}
{% block stylesheets %}
    {# On garde les styles de base (Bootstrap, etc.) #}
    {{ parent() }}
    
    {# On ajoute notre fichier perso #}
    <link rel="stylesheet" href="{{ asset('styles/responsable.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/navbarTel.css') }}">
{% endblock %}

{% block body %}
    <div class="mobile-container">
        <div class="header-section">
            <h1>üìä Rapport d'activit√©</h1>
            <p class="subtitle">Mise √† jour en temps r√©el</p>
        </div>

        {# Le formulaire avec l'auto-save #}
        {{ form_start(monFormulaire, {'attr': {'id': 'form-auto-save', 'class': 'modern-form'}}) }}
            
            {# S√©curit√© CSRF #}
            {{ form_row(monFormulaire._token) }}

            {# --- SECTION 1 : ACTIVIT√â (SLIDERS) --- #}
            <div class="card-section">
                <h2>Activit√© Terrain</h2>
                
                {# SLIDER TRACTS #}
                <div class="input-group-range">
                    <div class="range-header">
                        <label>Nombre de tracts</label>
                        {# Ce span affichera la valeur en direct #}
                        <span class="range-value" id="val-tract">0</span>
                    </div>
                    {{ form_widget(monFormulaire.tract, {'attr': {'class': 'custom-range', 'oninput': 'updateValue("val-tract", this.value)'}}) }}
                </div>

                <hr class="divider">

                {# SLIDER AFFLUENCE #}
                <div class="input-group-range">
                    <div class="range-header">
                        <label>Affluence</label>
                        <span class="range-value" id="val-afluence">0</span>
                    </div>
                    {{ form_widget(monFormulaire.afluence, {'attr': {'class': 'custom-range', 'oninput': 'updateValue("val-afluence", this.value)'}}) }}
                </div>
            </div>

            {# --- SECTION 2 : R√âSULTATS (SCORES) --- #}
            <div class="card-section">
                <h2>R√©sultats Syndicats</h2>
                <div class="scores-grid">
                    <div class="score-item unef">
                        {{ form_label(monFormulaire.unef) }}
                        {{ form_widget(monFormulaire.unef, {'attr': {'class': 'score-input'}}) }}
                    </div>
                    <div class="score-item ue">
                        {{ form_label(monFormulaire.ue) }}
                        {{ form_widget(monFormulaire.ue, {'attr': {'class': 'score-input'}}) }}
                    </div>
                    <div class="score-item uni">
                        {{ form_label(monFormulaire.uni) }}
                        {{ form_widget(monFormulaire.uni, {'attr': {'class': 'score-input'}}) }}
                    </div>
                </div>
            </div>

            {# Status de sauvegarde (feedback visuel) #}
            <div id="save-status" class="save-badge hidden">
                <span class="spinner"></span> Sauvegarde...
            </div>

            {# Bouton cach√© (car auto-save) #}
            <div class="d-none">
                <button type="submit">Sauvegarder</button>
            </div>

        {{ form_end(monFormulaire, {'render_rest': false}) }}
    </div>
    <script>
        // Petit script pour mettre √† jour les chiffres des sliders imm√©diatement
        function updateValue(id, value) {
            document.getElementById(id).innerText = value;
        }
        
        // Initialisation au chargement (pour afficher les valeurs d√©j√† en base)
        document.addEventListener("DOMContentLoaded", function() {
            const tractInput = document.querySelector('input[name="mon_pole[tract]"]');
            const affluenceInput = document.querySelector('input[name="mon_pole[afluence]"]');
            
            if(tractInput) updateValue('val-tract', tractInput.value);
            if(affluenceInput) updateValue('val-afluence', affluenceInput.value);
        });
    </script>
    {% include 'partials/_menuTel.html.twig' %}

{% endblock %}
{% block javascripts %}
    {{ parent() }}    
    <script src="{{ asset('controllers/sauvegarder.js') }}"></script>
{% endblock %}